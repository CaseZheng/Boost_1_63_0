# boost库 asio学习

# 高性能服务器程序框架 基础知识复习
- 按照服务器一般原理，可将服务器解构为以下三个主要模块：
    1. I/O处理单元。
    2. 逻辑单元。
    3. 存储单元。

## 1 服务器模型
### 1.1 C/S模型
- C/S(客户端/服务器)模型：所有客户端都通过访问服务器来获取所需的资源。
![TCP服务器和TCP客户端的工作流程](./Picture/asio_CS.jpg)
- C/S模型适合资源相对集中的场合，其实现也很简单，缺点明显：服务器是通信的中心，当访问量很大时，所有客户都讲得到很慢的响应。
### 1.2 P2P模型
- P2P(点对点)模型摒弃了以服务器为中心的格局，让网络上所有主机重新回归对等的地位。P2P模型让每台机器在消耗服务的同时也在给别人提供服务，让资源充分、自由地共享。缺点：当用户之间传输的请求过多时，网络的负载将加重。P2P模式通常带有一个专门的发现服务器，提供查找服务甚至提供内容服务，让每个客户尽快地找到自己需要的资源。P2P模型可以看做C/S模型的扩展：每台主机既是客户端，也是服务器。
![P2P模型 带有发现服务器的P2P模型](./Picture/asio_P2P.jpg)

## 2 服务器编程框架
- 服务器基本框架都一样，不同在于逻辑处理。
![服务器基本框架](./Picture/asio_service_1.jpg)
![服务器基本模块功能描述](./Picture/asio_service_2.jpg)
- I/O处理单元是服务器管理客户连接的模块。主要工作：1.等待并接受新的客户连接;2.接收客户数据;3.将服务器响应的数据返回客户端。对于服务器集群，I/O处理单元是一个专门的接入服务器，实现负载均衡，在所有逻辑服务器中选取负荷最小的一台为新客户服务。
- 一个逻辑单元是一个进程或线程，主要工作：分析并处理客户数据，并将结果传递给I/O处理单元或者直接发送给客户端。对服务器集群，一个逻辑单元就是一台逻辑服务器，服务器通常拥有多个逻辑单元，实现对多个客户任务的并行处理。
- 网络存储单元可以是数据库、缓存和文件，甚至一台独立服务器，但它不是必须的。
- 请求队列是各个单元间通信方式的抽象。对服务器集群，请求队列是各台服务器之间预先建立的、静态的、永久的TCP连接，该TCP连接提高服务器间交换数据的效率，避免动态建立TCP连接的额外的系统开销。

## 3 I/O模型
- 阻塞I/O，系统调用可能无法立即完成
- 理论上：阻塞I/O、I/O复用和信号驱动I/O都是同步I/O模型。因为在以上三种模型中，I/O的读写操作都是在I/O事件发生之后，由应用程序来完成的。
- 对于POSIX规范定义的异步I/O模型，用户可以直接对I/O执行读写操作，读写操作告诉内核用户读写缓冲区的位置，以及I/O操作完成后内核通知应用程序的方式，异步I/O的读写总是立即返回，不论I/O是否阻塞，因为真正的读写操作由内核接管。同步I/O模型要求用户代码自执行I/O操作，而异步I/O由内核来执行I/O操作。同步I/O向应用程序通知的是I/O就绪事件，而异步I/O向引用程序通知的是I/O完成事件。
![IO模型对比](./Picture/asio_IO.jpg)
